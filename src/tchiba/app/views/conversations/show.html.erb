<h1>Conversation</h1>
<h2>To: <%= @conversation.to_user.name %></h2>
<h2>From: <%= @conversation.from_user.name %></h2>
<h3>Subject: <%= @conversation.blend.name %></h3>

<% if @conversation.messages %>
  <% @conversation.messages.each do |message| %>
    <%= message.is_from_user ? @conversation.from_user.name : @conversation.to_user.name %><br>
    <%= message.content %>
    <%= message.created_at %>
  <% end %>
<% else %>
  <p>There are no messages in this conversation!</p>
<% end %>

<%= form_with model: @message, url: add_message_path(@conversation), local: true do |f| %>
  <% if @conversation.to_user.id == current_user.id %>
    <%= f.hidden_field :is_from_user, value: false %>
  <% end %>
  <%= f.text_area :content %>
  <%= f.submit %>
<% end %>

<% if @conversation.to_user.id == current_user.id %>
  <% if @conversation.is_active %>
    <%= link_to  "Mark conversation as in-active", inactive_path(@conversation), method: "PATCH",
                                                                        data: {confirm: "Are you sure? You will not be able to add new messages to the conversation if you do this."} %>
  <% end %>
  <%= link_to  "Delete conversation", conversation_path(@conversation), method: "DELETE",
                                                                    data: {confirm: "Are you sure you want to delete this conversation?"}   %>
<% end %>